[ Skip to content ](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graphstate>)
[ ![logo](https://ai.pydantic.dev/img/logo-white.svg) ](https://ai.pydantic.dev/api/pydantic_graph/state/..> "PydanticAI")
PydanticAI 
pydantic_graph.state 
Initializing search 
[ pydantic/pydantic-ai  ](https://ai.pydantic.dev/api/pydantic_graph/state/<https:/github.com/pydantic/pydantic-ai> "Go to repository")
[ ![logo](https://ai.pydantic.dev/img/logo-white.svg) ](https://ai.pydantic.dev/api/pydantic_graph/state/..> "PydanticAI") PydanticAI 
[ pydantic/pydantic-ai  ](https://ai.pydantic.dev/api/pydantic_graph/state/<https:/github.com/pydantic/pydantic-ai> "Go to repository")
  * [ Introduction  ](https://ai.pydantic.dev/api/pydantic_graph/state/..>)
  * [ Installation  ](https://ai.pydantic.dev/api/pydantic_graph/install/>)
  * [ Getting Help  ](https://ai.pydantic.dev/api/pydantic_graph/help/>)
  * [ Contributing  ](https://ai.pydantic.dev/api/pydantic_graph/contributing/>)
  * [ Troubleshooting  ](https://ai.pydantic.dev/api/pydantic_graph/troubleshooting/>)
  * Documentation  Documentation 
    * [ Agents  ](https://ai.pydantic.dev/api/pydantic_graph/agents/>)
    * [ Models  ](https://ai.pydantic.dev/api/pydantic_graph/models/>)
    * [ Dependencies  ](https://ai.pydantic.dev/api/pydantic_graph/dependencies/>)
    * [ Function Tools  ](https://ai.pydantic.dev/api/pydantic_graph/tools/>)
    * [ Results  ](https://ai.pydantic.dev/api/pydantic_graph/results/>)
    * [ Messages and chat history  ](https://ai.pydantic.dev/api/pydantic_graph/message-history/>)
    * [ Testing and Evals  ](https://ai.pydantic.dev/api/pydantic_graph/testing-evals/>)
    * [ Debugging and Monitoring  ](https://ai.pydantic.dev/api/pydantic_graph/logfire/>)
    * [ Multi-agent Applications  ](https://ai.pydantic.dev/api/pydantic_graph/multi-agent-applications/>)
    * [ Graphs  ](https://ai.pydantic.dev/api/pydantic_graph/graph/>)
  * [ Examples  ](https://ai.pydantic.dev/api/pydantic_graph/examples/>)
Examples 
    * [ Pydantic Model  ](https://ai.pydantic.dev/api/pydantic_graph/examples/pydantic-model/>)
    * [ Weather agent  ](https://ai.pydantic.dev/api/pydantic_graph/examples/weather-agent/>)
    * [ Bank support  ](https://ai.pydantic.dev/api/pydantic_graph/examples/bank-support/>)
    * [ SQL Generation  ](https://ai.pydantic.dev/api/pydantic_graph/examples/sql-gen/>)
    * [ Flight booking  ](https://ai.pydantic.dev/api/pydantic_graph/examples/flight-booking/>)
    * [ RAG  ](https://ai.pydantic.dev/api/pydantic_graph/examples/rag/>)
    * [ Stream markdown  ](https://ai.pydantic.dev/api/pydantic_graph/examples/stream-markdown/>)
    * [ Stream whales  ](https://ai.pydantic.dev/api/pydantic_graph/examples/stream-whales/>)
    * [ Chat App with FastAPI  ](https://ai.pydantic.dev/api/pydantic_graph/examples/chat-app/>)
    * [ Question Graph  ](https://ai.pydantic.dev/api/pydantic_graph/examples/question-graph/>)
  * API Reference  API Reference 
    * [ pydantic_ai.agent  ](https://ai.pydantic.dev/api/pydantic_graph/state/agent/>)
    * [ pydantic_ai.tools  ](https://ai.pydantic.dev/api/pydantic_graph/state/tools/>)
    * [ pydantic_ai.result  ](https://ai.pydantic.dev/api/pydantic_graph/state/result/>)
    * [ pydantic_ai.messages  ](https://ai.pydantic.dev/api/pydantic_graph/state/messages/>)
    * [ pydantic_ai.exceptions  ](https://ai.pydantic.dev/api/pydantic_graph/state/exceptions/>)
    * [ pydantic_ai.settings  ](https://ai.pydantic.dev/api/pydantic_graph/state/settings/>)
    * [ pydantic_ai.usage  ](https://ai.pydantic.dev/api/pydantic_graph/state/usage/>)
    * [ pydantic_ai.format_as_xml  ](https://ai.pydantic.dev/api/pydantic_graph/state/format_as_xml/>)
    * [ pydantic_ai.models  ](https://ai.pydantic.dev/api/pydantic_graph/state/models/base/>)
    * [ pydantic_ai.models.openai  ](https://ai.pydantic.dev/api/pydantic_graph/state/models/openai/>)
    * [ pydantic_ai.models.anthropic  ](https://ai.pydantic.dev/api/pydantic_graph/state/models/anthropic/>)
    * [ pydantic_ai.models.cohere  ](https://ai.pydantic.dev/api/pydantic_graph/state/models/cohere/>)
    * [ pydantic_ai.models.gemini  ](https://ai.pydantic.dev/api/pydantic_graph/state/models/gemini/>)
    * [ pydantic_ai.models.vertexai  ](https://ai.pydantic.dev/api/pydantic_graph/state/models/vertexai/>)
    * [ pydantic_ai.models.groq  ](https://ai.pydantic.dev/api/pydantic_graph/state/models/groq/>)
    * [ pydantic_ai.models.mistral  ](https://ai.pydantic.dev/api/pydantic_graph/state/models/mistral/>)
    * [ pydantic_ai.models.test  ](https://ai.pydantic.dev/api/pydantic_graph/state/models/test/>)
    * [ pydantic_ai.models.function  ](https://ai.pydantic.dev/api/pydantic_graph/state/models/function/>)
    * [ pydantic_graph  ](https://ai.pydantic.dev/api/pydantic_graph/state/<../graph/>)
    * [ pydantic_graph.nodes  ](https://ai.pydantic.dev/api/pydantic_graph/state/<../nodes/>)
    * pydantic_graph.state  [ pydantic_graph.state  ](https://ai.pydantic.dev/api/pydantic_graph/state/<./>) Table of contents 
      * [ state  ](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state>)
      * [ StateT  ](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.StateT>)
      * [ deep_copy_state  ](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.deep_copy_state>)
      * [ NodeStep  ](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.NodeStep>)
        * [ state  ](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.NodeStep.state>)
        * [ node  ](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.NodeStep.node>)
        * [ start_ts  ](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.NodeStep.start_ts>)
        * [ duration  ](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.NodeStep.duration>)
        * [ kind  ](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.NodeStep.kind>)
        * [ snapshot_state  ](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.NodeStep.snapshot_state>)
        * [ data_snapshot  ](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.NodeStep.data_snapshot>)
      * [ EndStep  ](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.EndStep>)
        * [ result  ](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.EndStep.result>)
        * [ ts  ](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.EndStep.ts>)
        * [ kind  ](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.EndStep.kind>)
        * [ data_snapshot  ](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.EndStep.data_snapshot>)
      * [ HistoryStep  ](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.HistoryStep>)
    * [ pydantic_graph.mermaid  ](https://ai.pydantic.dev/api/pydantic_graph/state/<../mermaid/>)
    * [ pydantic_graph.exceptions  ](https://ai.pydantic.dev/api/pydantic_graph/state/<../exceptions/>)


Table of contents 
  * [ state  ](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state>)
  * [ StateT  ](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.StateT>)
  * [ deep_copy_state  ](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.deep_copy_state>)
  * [ NodeStep  ](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.NodeStep>)
    * [ state  ](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.NodeStep.state>)
    * [ node  ](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.NodeStep.node>)
    * [ start_ts  ](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.NodeStep.start_ts>)
    * [ duration  ](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.NodeStep.duration>)
    * [ kind  ](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.NodeStep.kind>)
    * [ snapshot_state  ](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.NodeStep.snapshot_state>)
    * [ data_snapshot  ](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.NodeStep.data_snapshot>)
  * [ EndStep  ](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.EndStep>)
    * [ result  ](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.EndStep.result>)
    * [ ts  ](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.EndStep.ts>)
    * [ kind  ](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.EndStep.kind>)
    * [ data_snapshot  ](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.EndStep.data_snapshot>)
  * [ HistoryStep  ](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.HistoryStep>)


  1. [ Introduction  ](https://ai.pydantic.dev/api/pydantic_graph/state/..>)
  2. [ API Reference  ](https://ai.pydantic.dev/api/pydantic_graph/state/agent/>)


Version Notice
This documentation is ahead of the last release by [1 commit](https://ai.pydantic.dev/api/pydantic_graph/state/<https:/github.com/pydantic/pydantic-ai/compare/v0.0.21...main>). You may see documentation for features not yet supported in the latest release [v0.0.21 2025-01-30](https://ai.pydantic.dev/api/pydantic_graph/state/<https:/github.com/pydantic/pydantic-ai/releases/tag/v0.0.21>). 
# `pydantic_graph.state`
###  StateT `module-attribute`
```
StateT = TypeVar('StateT', default=None)

```

Type variable for the state in a graph.
###  deep_copy_state
```
deep_copy_state(state: StateT[](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.StateT> "pydantic_graph.state.StateT")) -> StateT[](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.StateT> "pydantic_graph.state.StateT")

```

Default method for snapshotting the state in a graph run, uses `copy.deepcopy`[](https://ai.pydantic.dev/api/pydantic_graph/state/<https:/docs.python.org/3/library/copy.html#copy.deepcopy>).
Source code in `pydantic_graph/pydantic_graph/state.py`
```
24
25
26
27
28
29
```
| ```
def deep_copy_state(state: StateT) -> StateT:
"""Default method for snapshotting the state in a graph run, uses [`copy.deepcopy`][copy.deepcopy]."""
  if state is None:
    return state
  else:
    return copy.deepcopy(state)

```
  
---|---  
###  NodeStep `dataclass`
Bases: `Generic[](https://ai.pydantic.dev/api/pydantic_graph/state/<https:/docs.python.org/3/library/typing.html#typing.Generic> "typing.Generic")[StateT[](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.StateT> "pydantic_graph.state.StateT"), RunEndT[](https://ai.pydantic.dev/api/pydantic_graph/state/<../nodes/#pydantic_graph.nodes.RunEndT> "pydantic_graph.nodes.RunEndT")]`
History step describing the execution of a node in a graph.
Source code in `pydantic_graph/pydantic_graph/state.py`
```
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
```
| ```
@dataclass
class NodeStep(Generic[StateT, RunEndT]):
"""History step describing the execution of a node in a graph."""
  state: StateT
"""The state of the graph after the node has been run."""
  node: Annotated[BaseNode[StateT, Any, RunEndT], CustomNodeSchema()]
"""The node that was run."""
  start_ts: datetime = field(default_factory=_utils.now_utc)
"""The timestamp when the node started running."""
  duration: float | None = None
"""The duration of the node run in seconds."""
  kind: Literal['node'] = 'node'
"""The kind of history step, can be used as a discriminator when deserializing history."""
  # TODO waiting for https://github.com/pydantic/pydantic/issues/11264, should be an InitVar
  snapshot_state: Annotated[Callable[[StateT], StateT], pydantic.Field(exclude=True, repr=False)] = field(
    default=deep_copy_state, repr=False
  )
"""Function to snapshot the state of the graph."""
  def __post_init__(self):
    # Copy the state to prevent it from being modified by other code
    self.state = self.snapshot_state(self.state)
  def data_snapshot(self) -> BaseNode[StateT, Any, RunEndT]:
"""Returns a deep copy of [`self.node`][pydantic_graph.state.NodeStep.node].
    Useful for summarizing history.
    """
    return copy.deepcopy(self.node)

```
  
---|---  
####  state `instance-attribute`
```
state: StateT[](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.StateT> "pydantic_graph.state.StateT")

```

The state of the graph after the node has been run.
####  node `instance-attribute`
```
node: Annotated[](https://ai.pydantic.dev/api/pydantic_graph/state/<https:/docs.python.org/3/library/typing.html#typing.Annotated> "typing.Annotated")[
  BaseNode[](https://ai.pydantic.dev/api/pydantic_graph/state/<../nodes/#pydantic_graph.nodes.BaseNode> "pydantic_graph.nodes.BaseNode")[StateT[](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.StateT> "pydantic_graph.state.StateT"), Any[](https://ai.pydantic.dev/api/pydantic_graph/state/<https:/docs.python.org/3/library/typing.html#typing.Any> "typing.Any"), RunEndT[](https://ai.pydantic.dev/api/pydantic_graph/state/<../nodes/#pydantic_graph.nodes.RunEndT> "pydantic_graph.nodes.RunEndT")], CustomNodeSchema()
]

```

The node that was run.
####  start_ts `class-attribute` `instance-attribute`
```
start_ts: datetime[](https://ai.pydantic.dev/api/pydantic_graph/state/<https:/docs.python.org/3/library/datetime.html#datetime.datetime> "datetime.datetime") = field[](https://ai.pydantic.dev/api/pydantic_graph/state/<https:/docs.python.org/3/library/dataclasses.html#dataclasses.field> "dataclasses.field")(default_factory=now_utc)

```

The timestamp when the node started running.
####  duration `class-attribute` `instance-attribute`
```
duration: float[](https://ai.pydantic.dev/api/pydantic_graph/state/<https:/docs.python.org/3/library/functions.html#float>) | None = None

```

The duration of the node run in seconds.
####  kind `class-attribute` `instance-attribute`
```
kind: Literal[](https://ai.pydantic.dev/api/pydantic_graph/state/<https:/docs.python.org/3/library/typing.html#typing.Literal> "typing.Literal")['node'] = 'node'

```

The kind of history step, can be used as a discriminator when deserializing history.
####  snapshot_state `class-attribute` `instance-attribute`
```
snapshot_state: Annotated[](https://ai.pydantic.dev/api/pydantic_graph/state/<https:/docs.python.org/3/library/typing.html#typing.Annotated> "typing.Annotated")[
  Callable[](https://ai.pydantic.dev/api/pydantic_graph/state/<https:/docs.python.org/3/library/typing.html#typing.Callable> "typing.Callable")[[StateT[](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.StateT> "pydantic_graph.state.StateT")], StateT[](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.StateT> "pydantic_graph.state.StateT")],
  Field[](https://ai.pydantic.dev/api/pydantic_graph/state/<https:/docs.pydantic.dev/latest/api/fields/#pydantic.fields.Field> "pydantic.Field")(exclude=True, repr=False),
] = field[](https://ai.pydantic.dev/api/pydantic_graph/state/<https:/docs.python.org/3/library/dataclasses.html#dataclasses.field> "dataclasses.field")(default=deep_copy_state[](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.deep_copy_state> "pydantic_graph.state.deep_copy_state"), repr=False)

```

Function to snapshot the state of the graph.
####  data_snapshot
```
data_snapshot() -> BaseNode[](https://ai.pydantic.dev/api/pydantic_graph/state/<../nodes/#pydantic_graph.nodes.BaseNode> "pydantic_graph.nodes.BaseNode")[StateT[](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.StateT> "pydantic_graph.state.StateT"), Any[](https://ai.pydantic.dev/api/pydantic_graph/state/<https:/docs.python.org/3/library/typing.html#typing.Any> "typing.Any"), RunEndT[](https://ai.pydantic.dev/api/pydantic_graph/state/<../nodes/#pydantic_graph.nodes.RunEndT> "pydantic_graph.nodes.RunEndT")]

```

Returns a deep copy of `self.node`[](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.NodeStep.node>).
Useful for summarizing history.
Source code in `pydantic_graph/pydantic_graph/state.py`
```
56
57
58
59
60
61
```
| ```
def data_snapshot(self) -> BaseNode[StateT, Any, RunEndT]:
"""Returns a deep copy of [`self.node`][pydantic_graph.state.NodeStep.node].
  Useful for summarizing history.
  """
  return copy.deepcopy(self.node)

```
  
---|---  
###  EndStep `dataclass`
Bases: `Generic[](https://ai.pydantic.dev/api/pydantic_graph/state/<https:/docs.python.org/3/library/typing.html#typing.Generic> "typing.Generic")[RunEndT[](https://ai.pydantic.dev/api/pydantic_graph/state/<../nodes/#pydantic_graph.nodes.RunEndT> "pydantic_graph.nodes.RunEndT")]`
History step describing the end of a graph run.
Source code in `pydantic_graph/pydantic_graph/state.py`
```
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
```
| ```
@dataclass
class EndStep(Generic[RunEndT]):
"""History step describing the end of a graph run."""
  result: End[RunEndT]
"""The result of the graph run."""
  ts: datetime = field(default_factory=_utils.now_utc)
"""The timestamp when the graph run ended."""
  kind: Literal['end'] = 'end'
"""The kind of history step, can be used as a discriminator when deserializing history."""
  def data_snapshot(self) -> End[RunEndT]:
"""Returns a deep copy of [`self.result`][pydantic_graph.state.EndStep.result].
    Useful for summarizing history.
    """
    return copy.deepcopy(self.result)

```
  
---|---  
####  result `instance-attribute`
```
result: End[](https://ai.pydantic.dev/api/pydantic_graph/state/<../nodes/#pydantic_graph.nodes.End> "pydantic_graph.nodes.End")[RunEndT[](https://ai.pydantic.dev/api/pydantic_graph/state/<../nodes/#pydantic_graph.nodes.RunEndT> "pydantic_graph.nodes.RunEndT")]

```

The result of the graph run.
####  ts `class-attribute` `instance-attribute`
```
ts: datetime[](https://ai.pydantic.dev/api/pydantic_graph/state/<https:/docs.python.org/3/library/datetime.html#datetime.datetime> "datetime.datetime") = field[](https://ai.pydantic.dev/api/pydantic_graph/state/<https:/docs.python.org/3/library/dataclasses.html#dataclasses.field> "dataclasses.field")(default_factory=now_utc)

```

The timestamp when the graph run ended.
####  kind `class-attribute` `instance-attribute`
```
kind: Literal[](https://ai.pydantic.dev/api/pydantic_graph/state/<https:/docs.python.org/3/library/typing.html#typing.Literal> "typing.Literal")['end'] = 'end'

```

The kind of history step, can be used as a discriminator when deserializing history.
####  data_snapshot
```
data_snapshot() -> End[](https://ai.pydantic.dev/api/pydantic_graph/state/<../nodes/#pydantic_graph.nodes.End> "pydantic_graph.nodes.End")[RunEndT[](https://ai.pydantic.dev/api/pydantic_graph/state/<../nodes/#pydantic_graph.nodes.RunEndT> "pydantic_graph.nodes.RunEndT")]

```

Returns a deep copy of `self.result`[](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.EndStep.result>).
Useful for summarizing history.
Source code in `pydantic_graph/pydantic_graph/state.py`
```
75
76
77
78
79
80
```
| ```
def data_snapshot(self) -> End[RunEndT]:
"""Returns a deep copy of [`self.result`][pydantic_graph.state.EndStep.result].
  Useful for summarizing history.
  """
  return copy.deepcopy(self.result)

```
  
---|---  
###  HistoryStep `module-attribute`
```
HistoryStep = Union[](https://ai.pydantic.dev/api/pydantic_graph/state/<https:/docs.python.org/3/library/typing.html#typing.Union> "typing.Union")[
  NodeStep[](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.NodeStep> "pydantic_graph.state.NodeStep")[StateT[](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.StateT> "pydantic_graph.state.StateT"), RunEndT[](https://ai.pydantic.dev/api/pydantic_graph/state/<../nodes/#pydantic_graph.nodes.RunEndT> "pydantic_graph.nodes.RunEndT")], EndStep[](https://ai.pydantic.dev/api/pydantic_graph/state/<#pydantic_graph.state.EndStep> "pydantic_graph.state.EndStep")[RunEndT[](https://ai.pydantic.dev/api/pydantic_graph/state/<../nodes/#pydantic_graph.nodes.RunEndT> "pydantic_graph.nodes.RunEndT")]
]

```

A step in the history of a graph run.
`Graph.run`[](https://ai.pydantic.dev/api/pydantic_graph/state/<../graph/#pydantic_graph.graph.Graph.run>) returns a list of these steps describing the execution of the graph, together with the run return value.
© Pydantic Services Inc. 2024 to present 
